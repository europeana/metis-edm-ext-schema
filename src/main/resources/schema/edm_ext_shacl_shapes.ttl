@prefix :        <http://www.europeana.eu/metis/edm/ext/> .
@prefix cc:      <http://creativecommons.org/ns#> .
@prefix dc:      <http://purl.org/dc/elements/1.1/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix edm:     <http://www.europeana.eu/schemas/edm/> .
@prefix foaf:    <http://xmlns.com/foaf/0.1/> .
@prefix ore:     <http://www.openarchives.org/ore/terms/> .
@prefix owl:     <http://www.w3.org/2002/07/owl#> .
@prefix rdaGr2:  <http://rdvocab.info/ElementsGr2/> .
@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh:      <http://www.w3.org/ns/shacl#> .
@prefix skos:    <http://www.w3.org/2004/02/skos/core#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .

### Property declarations ###
:StringLiteralOrIRIProperty
    sh:or ( [ sh:datatype xsd:string ] [ sh:datatype rdf:langString ] [ sh:nodeKind sh:IRI ] ) .

:StringLiteralProperty
    sh:or ( [ sh:datatype xsd:string ] [ sh:datatype rdf:langString ] ) .

:dcContributorProperty
    sh:path    dc:contributor ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcCoverageProperty
    sh:path    dc:coverage ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcCreatorProperty
    sh:path    dc:creator ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcDateProperty
    sh:path    dc:date ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcDescriptionProperty
    sh:path    dc:description ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcFormatProperty
    sh:path    dc:format ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcIdentifierProperty
    sh:path    dc:identifier ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:dcLanguageProperty
    sh:path    dc:language ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:dcPublisherProperty
    sh:path    dc:publisher ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcRelationProperty
    sh:path    dc:relation ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcRightsProperty
    sh:path    dc:rights ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcSourceProperty
    sh:path    dc:source ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcSubjectProperty
    sh:path    dc:subject ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dcTitleProperty
    sh:path    dc:title ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:dcTypeProperty
    sh:path    dc:type ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsAlternativeProperty
    sh:path    dcterms:alternative ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:dctermsConformsToProperty
    sh:path    dcterms:conformsTo ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsCreatedProperty
    sh:path    dcterms:created ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsExtentProperty
    sh:path    dcterms:extent ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsHasFormatProperty
    sh:path    dcterms:hasFormat ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsHasPartProperty
    sh:path    dcterms:hasPart ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsHasVersionProperty
    sh:path    dcterms:hasVersion ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsIsFormatOfProperty
    sh:path    dcterms:isFormatOf ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsIsPartOfProperty
    sh:path    dcterms:isPartOf ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsIsReferencedByProperty
    sh:path    dcterms:isReferencedBy ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsIsReplacedByProperty
    sh:path    dcterms:isReplacedBy ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsIsRepuiredByProperty
    sh:path    dcterms:isRequiredBy ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsIssuedProperty
    sh:path    dcterms:issued ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsIsVersionOfProperty
    sh:path    dcterms:isVersionOf ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsMediumProperty
    sh:path    dcterms:medium ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsProvenanceProperty
    sh:path    dcterms:provenance ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsReferencesProperty
    sh:path    dcterms:references ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsReplacesProperty
    sh:path    dcterms:replaces ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsRequiresProperty
    sh:path    dcterms:requires ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsSpatialProperty
    sh:path    dcterms:spatial ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:dctermsTableOfContentsProperty
    sh:path    dcterms:tableOfContents ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:dctermsTemporalProperty
    sh:path    dcterms:temporal ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:edmAggregatedCHOProperty
    sh:path     edm:aggregatedCHO ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmCurrentLocationProperty
    sh:path    edm:currentLocation ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:edmDataProviderProperty
    sh:path    edm:dataProvider ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:edmBeginProperty
    sh:path    edm:begin ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:edmEndProperty
    sh:path    edm:end ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:edmHasMetProperty
    sh:path     edm:hasMet ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmHasTypeProperty
    sh:path    edm:hasType ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:edmHasViewProperty
    sh:path     edm:hasView ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmIncorporatesProperty
    sh:path     edm:incorporates ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmIntermediateProviderProperty
    sh:path    edm:intermediateProvider ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:edmIsDerivativeOfProperty
    sh:path     edm:isDerivativeOf ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmIsNextInSequenceProperty
    sh:path     edm:isNextInSequence ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmIsRelatedToProperty
    sh:path    edm:isRelatedTo ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:edmIsRepresentationOfProperty
    sh:path     edm:isRepresentationOf ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmIsShownAtProperty
    sh:path     edm:isShownAt ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmIsShownByProperty
    sh:path     edm:isShownBy ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmIsSimilarToProperty
    sh:path     edm:isSimilarTo ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmIsSuccessorOfProperty
    sh:path     edm:isSuccessorOf ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmObjectProperty
    sh:path     edm:object ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmProviderProperty
    sh:path    edm:provider ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:edmRealizesProperty
    sh:path     edm:realizes ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmRightsProperty
    sh:path     edm:rights ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:edmTypeProperty
    sh:path    edm:type ;
    sh:node    :StringLiteralProperty ;
    sh:in      ( "TEXT" "VIDEO" "SOUND" "IMAGE" "3D" ) ;
    sh:message "edm:type must have one of the permitted literal values." .

:edmUgcProperty
    sh:path     edm:ugc ;
    sh:node     :StringLiteralProperty ;
    sh:maxCount 1 ;
    sh:pattern  "^true$" ;
    sh:message  "edm:ugc must be a string literal with value 'true' and can only occur once." .

:foafNameProperty
    sh:path    foaf:name ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:owlSameAsProperty
    sh:path     owl:sameAs ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:rdaGr2BiographicalInformation
    sh:path    rdaGr2:biographicalInformation ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:rdaGr2DateOfBirth
    sh:path    rdaGr2:dateOfBirth ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:rdaGr2DateOfDeath
    sh:path    rdaGr2:dateOfDeath ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:rdaGr2DateOfEstablishment
    sh:path    rdaGr2:dateOfEstablishment ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:rdaGr2DateOfTermination
    sh:path    rdaGr2:dateOfTermination ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:rdaGr2Gender
    sh:path    rdaGr2:gender ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:rdaGr2PlaceOfBirth
    sh:path    rdaGr2:placeOfBirth ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:rdaGr2PlaceOfDeath
    sh:path    rdaGr2:placeOfDeath ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:rdaGr2ProfessionOrOccupation
    sh:path    rdaGr2:professionOrOccupation ;
    sh:node    :StringLiteralOrIRIProperty ;
    sh:message "This property must be a string literal or a reference." .

:skosAltLabelProperty
    sh:path    skos:altLabel ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:skosBroaderProperty
    sh:path     skos:broader ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:skosBroadMatchProperty
    sh:path     skos:broadMatch ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:skosCloseMatchProperty
    sh:path     skos:closeMatch ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:skosExactMatchProperty
    sh:path     skos:exactMatch ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:skosInSchemeProperty
    sh:path     skos:inScheme ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:skosNarrowerProperty
    sh:path     skos:narrower ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:skosNarrowMatchProperty
    sh:path     skos:narrowMatch ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:skosNotationProperty
    sh:path     skos:notation ;
    sh:nodeKind sh:Literal ;
    sh:message  "skos:notation must be a literal of any type." .

:skosNoteProperty
    sh:path    skos:note ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:skosPrefLabelProperty
    sh:path    skos:prefLabel ;
    sh:node    :StringLiteralProperty ;
    sh:message "This property must be a string literal." .

:skosRelatedProperty
    sh:path     skos:related ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .

:skosRelatedMatchProperty
    sh:path     skos:relatedMatch ;
    sh:nodeKind sh:IRI ;
    sh:message  "This property must be a reference." .



### Property target declarations ###


# TODO in the following checks, this schema follows the documentation. But we should verify and adjust.
# TODO check: dc:coverage in the docs can also have timespan, but we enrich only for Place.
# TODO check: fields that are not enriched but could be according to the docs: dc:publisher, ...
# TODO        edm:currentLocation, edm:hasType, edm:isRelatedTo?, dc:relation?
# TODO check: dcterms:medium and dc:format is enriched as if it always has a Concept, but this is
# TODO        not clear from the docs. However, it is kind of implied in the EDM definition.
# TODO check: Organization objects (and references to them) are not expected in EDM external?

# TODO check: The acceptable referenced classes/objects for each property. Where the documentation
# TODO        it says 'resource' it is assumed to be a resource on the web somewhere.


# These shapes verify that the various properties reference the right type of classes.
# The typing conditions for contextual class references are designed to avoid failing on literals,
# or on IRIs that are not resolvable in the record.
# TODO Nuno is working on formalizing the range description of the various properties.
:EdmClassWithCorrectReferencesShape
    a              sh:NodeShape ;
    sh:targetClass :EdmClass ;
    sh:property    [ sh:path    edm:aggregatedCHO ;
                     sh:class   edm:ProvidedCHO ;
                     sh:message "edm:aggregatedCHO must reference an edm:ProvidedCHO." ] ;
    sh:property    [ sh:path     [ sh:alternativePath ( dc:relation dc:source dcterms:hasVersion
                                                        dcterms:isReferencedBy dcterms:isReplacedBy
                                                        dcterms:isRequiredBy dcterms:isVersionOf dcterms:references
                                                        dcterms:replaces dcterms:requires edm:incorporates
                                                        edm:isDerivativeOf edm:isRepresentationOf
                                                        edm:isSimilarTo edm:isSuccessorOf edm:realizes ) ] ;
                     sh:or       ( [ sh:class edm:ProvidedCHO ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class other than edm:ProvidedCHO." ] ;
    sh:property    [ sh:path     [ sh:alternativePath ( dcterms:hasFormat dcterms:isFormatOf ) ] ;
                     sh:or       ( [ sh:class edm:ProvidedCHO ]
                                   [ sh:class edm:WebResource ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class other than edm:ProvidedCHO or edm:WebResource." ] ;
    sh:property    [ sh:path     [ sh:alternativePath ( edm:hasView edm:isShownAt edm:isShownBy edm:object ) ] ;
                     sh:or       ( [ sh:class edm:WebResource ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class other than edm:WebResource." ] ;
    sh:property    [ sh:path     [ sh:alternativePath ( dc:contributor dc:creator dc:publisher ) ] ;
                     sh:or       ( [ sh:class edm:Agent ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class other than edm:Agent." ] ;
    sh:property    [ sh:path     [ sh:alternativePath ( dc:subject dc:type edm:hasType rdaGr2:professionOrOccupation
                                                        skos:broader skos:narrower skos:related
                                                        skos:broadMatch skos:narrowMatch skos:relatedMatch
                                                        skos:closeMatch skos:exactMatch ) ] ;
                     sh:or       ( [ sh:class skos:Concept ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class other than skos:Concept." ] ;
    sh:property    [ sh:path     [ sh:alternativePath ( dcterms:spatial edm:currentLocation
                                                        rdaGr2:placeOfBirth rdaGr2:placeOfDeath ) ] ;
                     sh:or       ( [ sh:class edm:Place ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class other than edm:Place." ] ;
    sh:property    [ sh:path     [ sh:alternativePath ( dc:date dcterms:created dcterms:issued dcterms:temporal ) ] ;
                     sh:or       ( [ sh:class edm:TimeSpan ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class other than edm:TimeSpan." ] ;
    sh:property    [ sh:path     dc:coverage ;
                     sh:or       ( [ sh:class edm:Place ]
                                   [ sh:class edm:TimeSpan ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class other than edm:Place or edm:TimeSpan." ] ;
    sh:property    [ sh:path     edm:rights ;
                     sh:or       ( [ sh:class cc:License ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class other than cc:License." ] ;
    sh:property    [ sh:path     edm:hasMet ;
                     sh:or       ( [ sh:class :ContextualClass ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class other than a contextual entity." ] ;
    sh:property    [ sh:path     [ sh:alternativePath ( dc:description dc:format dc:rights dcterms:conformsTo
                                                        dcterms:extent dcterms:medium dcterms:provenance ) ] ;
                     sh:not      [ sh:class :EdmClass ] ;
                     sh:severity sh:Warning ;
                     sh:message  "This property should not reference an EDM class." ] ;
    sh:property    [ sh:path     [ sh:alternativePath ( edm:dataProvider edm:intermediateProvider edm:provider
                                                        skos:inScheme ) ] ;
                     sh:not      [ sh:class :EdmClass ] ;
                     sh:severity sh:Warning ;
                     sh:message  "This property relates to Organizations and should not reference an EDM external class." ] .

:ProvidedCHOWithCorrectReferencesShape
    a              sh:NodeShape ;
    sh:targetClass edm:ProvidedCHO ;
    sh:property    [ sh:path     [ sh:alternativePath ( dcterms:hasPart dcterms:isPartOf
                                                        edm:isNextInSequence owl:sameAs ) ] ;
                     sh:or       ( [ sh:class edm:ProvidedCHO ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property in a ProvidedCHO should not reference an EDM class other than edm:ProvidedCHO." ] ;
    sh:property    [ sh:path     edm:isRelatedTo ;
                     sh:or       ( [ sh:class edm:ProvidedCHO ]
                                   [ sh:class skos:Concept ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property in a ProvidedCHO should not reference an EDM class other than edm:ProvidedCHO or skos:Concept." ] .

:WebResourceWithCorrectReferencesShape
    a              sh:NodeShape ;
    sh:targetClass edm:WebResource ;
    sh:property    [ sh:path      [ sh:alternativePath ( dcterms:hasPart dcterms:isPartOf
                                                         edm:isNextInSequence owl:sameAs ) ] ;
                     sh:or       ( [ sh:class edm:WebResource ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property in a WebResource should not reference an EDM class other than edm:WebResource." ] .

:AgentWithCorrectReferencesShape
    a              sh:NodeShape ;
    sh:targetClass edm:Agent ;
    sh:property    [ sh:path     [ sh:alternativePath ( dcterms:hasPart dcterms:isPartOf owl:sameAs ) ] ;
                     sh:or       ( [ sh:class edm:Agent ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property in an Agent should not reference an EDM class other than edm:Agent." ] ;
    sh:property    [ sh:path     edm:isRelatedTo ;
                     sh:or       ( [ sh:class :ContextualClass ]
                                   [ sh:not [ sh:class :EdmClass ] ] ) ;
                     sh:severity sh:Warning ;
                     sh:message  "This property in an Agent should not reference an EDM class other than a contextual entity." ] .


### Shape declarations ###

# Note: some properties are mandated to be non-empty in the definitions below. These properties are
# involved in specific requirements for presence. If a property (or at least one of a group of
# properties) is required to be present, then it should not be allowed to be empty. This is not
# only out of data correctness, but also to prevent normalisation from invalidating the record.
# During normalisation emtpy properties may be removed and the record could become invalid as a result.
# Note: this only applies when the property is allowed to be a literal.

# ProvidedCHO: The closed list of permitted properties.
:ProvidedCHOShape
    a                    sh:NodeShape ;
    sh:targetClass       edm:ProvidedCHO ;
    sh:closed            true ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:message           "This edm:ProvidedCho object contains unexpected properties." ;
    sh:property          :dcContributorProperty ;
    sh:property          :dcCoverageProperty ;
    sh:property          :dcCreatorProperty ;
    sh:property          :dcDateProperty ;
    sh:property          :dcDescriptionProperty ;
    sh:property          :dcFormatProperty ;
    sh:property          :dcIdentifierProperty ;
    sh:property          :dcLanguageProperty ;
    sh:property          :dcPublisherProperty ;
    sh:property          :dcRelationProperty ;
    sh:property          :dcRightsProperty ;
    sh:property          :dcSourceProperty ;
    sh:property          :dcSubjectProperty ;
    sh:property          :dcTitleProperty ;
    sh:property          :dcTypeProperty ;
    sh:property          :dctermsAlternativeProperty ;
    sh:property          :dctermsConformsToProperty ;
    sh:property          :dctermsCreatedProperty ;
    sh:property          :dctermsExtentProperty ;
    sh:property          :dctermsHasFormatProperty ;
    sh:property          :dctermsHasPartProperty ;
    sh:property          :dctermsHasVersionProperty ;
    sh:property          :dctermsIsFormatOfProperty ;
    sh:property          :dctermsIsPartOfProperty ;
    sh:property          :dctermsIsReferencedByProperty ;
    sh:property          :dctermsIsReplacedByProperty ;
    sh:property          :dctermsIsRepuiredByProperty ;
    sh:property          :dctermsIssuedProperty ;
    sh:property          :dctermsIsVersionOfProperty ;
    sh:property          :dctermsMediumProperty ;
    sh:property          :dctermsProvenanceProperty ;
    sh:property          :dctermsReferencesProperty ;
    sh:property          :dctermsReplacesProperty ;
    sh:property          :dctermsRequiresProperty ;
    sh:property          :dctermsSpatialProperty ;
    sh:property          :dctermsTableOfContentsProperty ;
    sh:property          :dctermsTemporalProperty ;
    sh:property          :edmCurrentLocationProperty ;
    sh:property          :edmHasMetProperty ;
    sh:property          :edmHasTypeProperty ;
    sh:property          :edmIncorporatesProperty ;
    sh:property          :edmIsDerivativeOfProperty ;
    sh:property          :edmIsNextInSequenceProperty ;
    sh:property          :edmIsRelatedToProperty ;
    sh:property          :edmIsRepresentationOfProperty ;
    sh:property          :edmIsSimilarToProperty ;
    sh:property          :edmIsSuccessorOfProperty ;
    sh:property          :edmRealizesProperty ;
    sh:property          :edmTypeProperty ;
    sh:property          :owlSameAsProperty .

# ProvidedCHO: There needs to be at least a description or title, and the description should be a
# literal. Also, there needs to be at least a dc:subject, dc:type, dcterms:spatial or dcterms:temporal.
# TODO hasView can only occur if isShownBy has already been used. According to Hugo:check with Nuno. Warning, not violation.
:ProvidedCHOCardinalitiesShape
    a              sh:NodeShape ;
    sh:targetClass edm:ProvidedCHO ;
    sh:property    [ sh:path       dc:title ;
                     sh:uniqueLang true ;
                     sh:severity   sh:Warning ;
                     sh:message    "There should be only one dc:title value per language. " ] ;
    sh:property    [ sh:path       dc:description ;
                     sh:or         ( [ sh:datatype xsd:string ] [ sh:datatype rdf:langString ] ) ;
                     sh:severity   sh:Warning ;
                     sh:message    "dc:description should be a string literal, not a reference." ] ;
    sh:property    [ sh:path       edm:currentLocation ;
                     sh:maxCount   1 ;
                     sh:message    "edm:currentLocation can only occur once." ] ;
    sh:property    [ sh:path       edm:isRepresentationOf ;
                     sh:maxCount   1 ;
                     sh:message    "edm:isRepresentationOf can only occur once." ] ;
    sh:property    [ sh:path       edm:type ;
                     sh:minCount   1 ;
                     sh:maxCount   1 ;
                     sh:message    "edm:type must occur exactly once." ] ;
    sh:property    [ sh:path                [ sh:alternativePath ( dc:title dc:description ) ] ;
                     sh:qualifiedValueShape [ sh:pattern "\\S" ] ;
                     sh:qualifiedMinCount   1 ;
                     sh:message             "At least one the following properties must be present and non-whitespace: dc:title or dc:description." ] ;
    sh:property    [ sh:path                [ sh:alternativePath ( dc:subject dc:type dcterms:spatial dcterms:temporal ) ] ;
                     sh:qualifiedValueShape [ sh:pattern "\\S" ] ;
                     sh:qualifiedMinCount   1 ;
                     sh:message             "At least one the following properties should be present and non-empty: dc:subject, dc:type, dcterms:spatial or dcterms:temporal." ] .

# ProvidedCHO: If this is a TEXT object, we require a language.
:ProvidedCHOForTextWithLanguageShape
    a              sh:NodeShape ;
    sh:targetClass edm:ProvidedCHO ;
    sh:or          ( [ sh:path                dc:language ;
                       sh:qualifiedValueShape [ sh:pattern "\\S" ] ;
                       sh:qualifiedMinCount   1 ]
                     [ sh:not [ sh:path    edm:type ;
                                sh:pattern "^TEXT$" ] ] ) ;
    sh:message     "At least one non-whitespace occurrence of the property dc:language is required if edm:type='TEXT'." .

# Aggregation: The closed list of permitted properties.
:AggregationShape
    a                    sh:NodeShape ;
    sh:targetClass       ore:Aggregation ;
    sh:closed            true ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:message           "This ore:Aggregation object contains unexpected properties." ;
    sh:property          :dcRightsProperty ;
    sh:property          :edmAggregatedCHOProperty ;
    sh:property          :edmDataProviderProperty ;
    sh:property          :edmHasViewProperty ;
    sh:property          :edmIntermediateProviderProperty ;
    sh:property          :edmIsShownAtProperty ;
    sh:property          :edmIsShownByProperty ;
    sh:property          :edmObjectProperty ;
    sh:property          :edmProviderProperty ;
    sh:property          :edmRightsProperty ;
    sh:property          :edmUgcProperty.

# Aggregation: There needs to be at least a edm:isShownAt or edm:isShownBy.
:AggregationCardinalitiesShape
    a              sh:NodeShape ;
    sh:targetClass ore:Aggregation ;
    sh:property    [ sh:path     edm:aggregatedCHO ;
                     sh:minCount 1 ;
                     sh:maxCount 1 ;
                     sh:message  "edm:aggregatedCHO must be present exactly once." ] ;
    sh:property    [ sh:path     edm:dataProvider ;
                     sh:minCount 1 ;
                     sh:maxCount 1 ;
                     sh:pattern  "\\S" ;
                     sh:message  "edm:dataProvider must occur exactly once and must be non-empty."] ;
    sh:property    [ sh:path     edm:isShownAt ;
                     sh:maxCount 1 ;
                     sh:message  "edm:isShownAt can only occur once." ] ;
    sh:property    [ sh:path     edm:isShownBy ;
                     sh:maxCount 1 ;
                     sh:message  "edm:isShownBy can only occur once." ] ;
    sh:property    [ sh:path     edm:object ;
                     sh:maxCount 1 ;
                     sh:message  "edm:object can only occur once." ] ;
    sh:property    [ sh:path     edm:provider ;
                     sh:minCount 1 ;
                     sh:maxCount 1 ;
                     sh:pattern  "\\S" ;
                     sh:message  "edm:provider must occur exactly once and must be non-empty." ] ;
    sh:property    [ sh:path     edm:rights ;
                     sh:minCount 1 ;
                     sh:maxCount 1 ;
                     sh:message  "edm:rights must occur exactly once." ] ;
    sh:property    [ sh:path     [ sh:alternativePath ( edm:isShownAt edm:isShownBy ) ] ;
                     sh:minCount 1 ;
                     sh:message  "At least one the following properties must be present: edm:isShownAt or edm:isShownBy." ] .

# Aggregation: Warn if an IMAGE has no edm:isShownBy or edm:object.
:AggregationForImageWithRightMediaLinksShape
    a              sh:NodeShape ;
    sh:targetClass ore:Aggregation ;
    sh:or          ( [ sh:path     [ sh:alternativePath ( edm:isShownBy edm:object ) ] ;
                       sh:minCount 1 ]
                     [ sh:not      [ sh:path    ( edm:aggregatedCHO edm:type ) ;
                                     sh:pattern "^IMAGE$" ] ] ) ;
    sh:severity    sh:Warning ;
    sh:message     "At least one of edm:isShownBy or edm:object is required for publication if edm:type='IMAGE'." .

# WebResource: The closed list of permitted properties.
:WebResourceShape
    a                    sh:NodeShape ;
    sh:targetClass       edm:WebResource ;
    sh:closed            true ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:message           "This edm:WebResource object contains unexpected properties." ;
    sh:property          :dcCreatorProperty ;
    sh:property          :dcDescriptionProperty ;
    sh:property          :dcFormatProperty ;
    sh:property          :dcRightsProperty ;
    sh:property          :dcSourceProperty ;
    sh:property          :dcTypeProperty ;
    sh:property          :dctermsConformsToProperty ;
    sh:property          :dctermsCreatedProperty ;
    sh:property          :dctermsExtentProperty ;
    sh:property          :dctermsHasPartProperty ;
    sh:property          :dctermsIsFormatOfProperty ;
    sh:property          :dctermsIsPartOfProperty ;
    sh:property          :dctermsIsReferencedByProperty ;
    sh:property          :dctermsIssuedProperty ;
    sh:property          :edmIsNextInSequenceProperty ;
    sh:property          :edmRightsProperty ;
    sh:property          :owlSameAsProperty .

:WebResourceCardinalitiesShape
    a              sh:NodeShape ;
    sh:targetClass edm:WebResource ;
    sh:property    [ sh:path     edm:rights ;
                     sh:maxCount 1 ;
                     sh:message  "edm:rights may only occur once." ] .

# Contextual classes
:ContextualClassCardinalitiesShape
    a              sh:NodeShape ;
    sh:targetClass :ContextualClass ;
    sh:property    [ sh:path       skos:prefLabel ;
                     sh:minCount   1 ;
                     sh:pattern    "\\S" ;
                     sh:severity   sh:Warning ;
                     sh:message    "There should be at least one non-empty skos:prefLabel." ] ;
    sh:property    [ sh:path       skos:prefLabel ;
                     sh:uniqueLang true ;
                     sh:severity   sh:Warning ;
                     sh:message    "There should be at most one skos:prefLabel value per language." ] .

# Agent
:AgentShape
    a                    sh:NodeShape ;
    sh:targetClass       edm:Agent ;
    sh:closed            true ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property          :dcDateProperty ;
    sh:property          :dcIdentifierProperty ;
    sh:property          :dctermsHasPartProperty ;
    sh:property          :dctermsIsPartOfProperty ;
    sh:property          :edmBeginProperty ;
    sh:property          :edmEndProperty ;
    sh:property          :edmHasMetProperty ;
    sh:property          :edmIsRelatedToProperty ;
    sh:property          :foafNameProperty ;
    sh:property          :owlSameAsProperty ;
    sh:property          :rdaGr2BiographicalInformation ;
    sh:property          :rdaGr2DateOfBirth ;
    sh:property          :rdaGr2DateOfDeath ;
    sh:property          :rdaGr2DateOfEstablishment ;
    sh:property          :rdaGr2DateOfTermination ;
    sh:property          :rdaGr2Gender ;
    sh:property          :rdaGr2PlaceOfBirth ;
    sh:property          :rdaGr2PlaceOfDeath ;
    sh:property          :rdaGr2ProfessionOrOccupation ;
    sh:property          :skosAltLabelProperty ;
    sh:property          :skosNoteProperty ;
    sh:property          :skosPrefLabelProperty .

:AgentCardinalitiesShape
    a              sh:NodeShape ;
    sh:targetClass edm:Agent ;
    sh:property    [ sh:path     edm:begin ;
                     sh:maxCount 1 ;
                     sh:message  "edm:begin can only occur once." ] ;
    sh:property    [ sh:path     edm:end ;
                     sh:maxCount 1 ;
                     sh:message  "edm:end can only occur once." ] ;
    sh:property    [ sh:path     rdaGr2:dateOfBirth ;
                     sh:maxCount 1 ;
                     sh:message  "rdaGr2:dateOfBirth can only occur once." ] ;
    sh:property    [ sh:path     rdaGr2:dateOfDeath ;
                     sh:maxCount 1 ;
                     sh:message  "rdaGr2:dateOfDeath can only occur once." ] ;
    sh:property    [ sh:path     rdaGr2:dateOfEstablishment ;
                     sh:maxCount 1 ;
                     sh:message  "rdaGr2:dateOfEstablishment can only occur once." ] ;
    sh:property    [ sh:path     rdaGr2:dateOfTermination ;
                     sh:maxCount 1 ;
                     sh:message  "rdaGr2:dateOfTermination can only occur once." ] ;
    sh:property    [ sh:path     rdaGr2:gender ;
                     sh:maxCount 1 ;
                     sh:message  "rdaGr2:gender can only occur once." ] ;
    sh:property    [ sh:path     rdaGr2:placeOfBirth ;
                     sh:maxCount 1 ;
                     sh:message  "rdaGr2:placeOfBirth can only occur once." ] ;
    sh:property    [ sh:path     rdaGr2:placeOfDeath ;
                     sh:maxCount 1 ;
                     sh:message  "rdaGr2:placeOfDeath can only occur once." ] .

# Concept
:ConceptShape
    a                    sh:NodeShape ;
    sh:targetClass       skos:Concept ;
    sh:closed            true ;
    sh:ignoredProperties ( rdf:type ) ;
    sh:property          :skosPrefLabelProperty ;
    sh:property          :skosAltLabelProperty ;
    sh:property          :skosBroaderProperty ;
    sh:property          :skosNarrowerProperty ;
    sh:property          :skosRelatedProperty ;
    sh:property          :skosBroadMatchProperty ;
    sh:property          :skosNarrowMatchProperty ;
    sh:property          :skosRelatedMatchProperty ;
    sh:property          :skosExactMatchProperty ;
    sh:property          :skosCloseMatchProperty ;
    sh:property          :skosNoteProperty ;
    sh:property          :skosNotationProperty ;
    sh:property          :skosInSchemeProperty .

# Place
:PlaceShape
    a                    sh:NodeShape ;
    sh:targetClass       edm:Place ;
    sh:closed            true ;
    sh:ignoredProperties ( rdf:type ) .

# TimeSpan
:TimeSpanShape
    a                    sh:NodeShape ;
    sh:targetClass       edm:TimeSpan ;
    sh:closed            true ;
    sh:ignoredProperties ( rdf:type ) .

# License
:LicenseShape
    a                    sh:NodeShape ;
    sh:targetClass       cc:License ;
    sh:closed            true ;
    sh:ignoredProperties ( rdf:type ) .
